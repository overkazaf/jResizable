<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		.ui-panel{
			position: absolute;top:0;left:0;
			width:400px;height:240px;border:1px solid #000;box-shadow: 0 2px 10px #aaa;
		}
		.ui-panel-header{
			cursor:move;
			z-index:1;position: absolute;left: 0;top: 0;width:100%;
			height:32px;font-size:12px;line-height: 32px;background-color: #09F;text-align: center;color:#FFF;
			opacity: 0.7;
		}
		.ui-panel:hover .ui-panel-header{opacity: 1;}
		.ui-panel-body{background-color:#2b2b2b;position:relative;height: 100%;width:100%;opacity: 0.9;}
		.ui-ctrl-e{
			position: absolute;right:-5px;top:0;width:10px;
			height:100%;background-color: transparent;
			cursor : e-resize;
		}

		.ui-ctrl-s{
			position: absolute;left:0;bottom:-5px;width:100%;
			height:10px;background-color: transparent;
			cursor : s-resize;
		}

		.ui-ctrl-se{
			position: absolute;right:-10px;bottom:-10px;width:20px;
			height:20px;background-color: transparent;
			cursor : se-resize;
		}
		.container{
			position: relative;left:100px;top: 100px;
		}
	</style>
</head>
<body>
	<div class="container">
		
	</div>
</body>
<script type="text/javascript">
	function buildPanel (context, panelId, callback) {
		context = context || document.body;
		var fragment = document.createDocumentFragment();
		var oPanel = document.createElement('div');
		var oHeader = document.createElement('div');
		var oBody = document.createElement('div');

		oPanel.className = 'ui-panel';
		oPanel.id = panelId;
		oHeader.className = 'ui-panel-header';
		oBody.className = 'ui-panel-body';
		oHeader.innerHTML = 'Panel title';

		oPanel.appendChild(oHeader);
		oPanel.appendChild(oBody);
		fragment.appendChild(oPanel);

		if (callback && typeof callback == 'function') {
			context.appendChild(fragment);
			callback();
		} else {
			return context.appendChild(fragment);
		}
	}
	$globalIndex = 0;
	window.onload = function (){
		var panelList = [];
		var ctx = document.getElementsByClassName('container')[0];
		for (var i=1; i<10; i++) {
			var panelId = 'test'+ i;
			buildPanel(ctx, panelId, function (){
				var r = new Resizable('init', {
					panelId : panelId,
					minx : 120,
					miny : 60,
					draggable : true,
					minDx : 10,
					minDy : 10
				});
				r.instance.style.zIndex = ++$globalIndex;
				panelList[panelList.length] = r;
			});
		}
	}

	function Resizable(method, options, fn){
		if (this[method]) {
			this[method](options);
		} else {
			this.prototype[method] = fn;
		}

		return this;
	}

	Resizable.prototype = {
		constructor : Resizable,
		instance : null,
		header : null,
		body : null,
		footer : null,
		ctrl : null,
		init : function (opts){
			var instance = document.getElementById(opts.panelId);
			var header = instance.getElementsByClassName('ui-panel-header')[0];
			var body = instance.getElementsByClassName('ui-panel-body')[0];
			var footer = instance.getElementsByClassName('ui-panel-footer')[0];

			var ctrlE = document.createElement('div');
			var ctrlS = document.createElement('div');
			var ctrlSE = document.createElement('div');
			header.class = 'ui-panel-header';
			ctrlE.class = ctrlE.className = 'ui-ctrl-e';
			ctrlS.class = ctrlS.className = 'ui-ctrl-s';
			ctrlSE.class = ctrlSE.className = 'ui-ctrl-se';

			instance.appendChild(ctrlE);
			instance.appendChild(ctrlS);
			instance.appendChild(ctrlSE);

			this.instance = instance;
			this.header = header;
			this.body = body;
			this.footer = footer;
			this.ctrl = {
				E : ctrlE,
				S : ctrlS,
				SE: ctrlSE
			};
			this.minx = opts.minx || 0;
			this.miny = opts.miny || 0;
			this.bindEvent(opts);
		},
		bindEvent : function (opts){
			var ctrl = this.ctrl;
			var obj = this.instance;
			var header = this.header;
			var minx = this.minx;
			var miny = this.miny;

			// Resizable & Draggable
			header.onmousedown = ctrl.SE.onmousedown = ctrl.S.onmousedown = ctrl.E.onmousedown = function (ev){
				ev = fixEvent(ev);
				if (obj.style.zIndex < $globalIndex){
					obj.style.zIndex = ++$globalIndex;
				}
				var pOL = 0,
					pOT = 0,
					p = obj;
				while (p && p!= obj) {
					pOL += p.offsetLeft;
					pOT += p.offsetTop;
					p = p.offsetParent;
				}
				var disX = ev.pageX - pOL - obj.offsetWidth;
				var disY = ev.pageY - pOT - obj.offsetHeight;
				var type = ev.target.class;
				if (type == 'ui-panel-header') {
					disX = ev.pageX - obj.offsetLeft;
					disY = ev.pageY - obj.offsetTop;
				}
				document.onmousemove = function (ev){
					ev = fixEvent(ev);
					var tx = ev.pageX - disX;
					var ty = ev.pageY - disY;
					if (type == 'ui-panel-header') {
						tx = ev.pageX - disX;
						ty = ev.pageY - disY;
					} else {
						tx = Math.max(tx, minx);
						ty = Math.max(ty, miny);
					}
					switch (type) {
						case 'ui-ctrl-e': 
							ctrl.E.style.left = tx +  'px';
							ctrl.SE.style.left = tx - 5 + 'px';
							obj.style.width = tx + 5 + 'px';
							break;
						case 'ui-ctrl-s':
							ctrl.S.style.top = ty +  'px';
							ctrl.SE.style.top = ty - 5 +  'px';
							obj.style.height = ty + 5 + 'px';
							break;
						case 'ui-ctrl-se':
							ctrl.E.style.left = tx - 5 +  'px';
							ctrl.S.style.top = ty - 5 + 'px';
							ctrl.SE.style.left = tx -10 +  'px';
							ctrl.SE.style.top = ty -10+  'px';
							obj.style.width = tx  + 'px';
							obj.style.height = ty  + 'px';
							break;

						//draggable
						case 'ui-panel-header':
							obj.style.left = tx + 'px';
							obj.style.top = ty + 'px';
							break;
					}
				}

				document.onmouseup = function (){
					document.onmousemove = null;
					document.onmouseup = null;
				}

				return false;
				
			}


			// if (opts.Draggable) {
			// 	header.onmousedown = function (ev){
			// 		ev = fixEvent(ev);
			// 		var pOL = 0,
			// 			pOT = 0,
			// 			p = obj;
			// 		while (p && p!= obj) {
			// 			pOL += p.offsetLeft;
			// 			pOT += p.offsetTop;
			// 			p = p.offsetParent;
			// 		}
			// 		var disX = ev.pageX - pOL - obj.offsetWidth;
			// 		var disY = ev.pageY - pOT - obj.offsetHeight;
			// 		var type = ev.target.class;
			// 	}
			// }
		}
	};

	function log(k,v){console.log(k,v);};
	function fixEvent(ev){return ev || window.event;}
</script>
</html>